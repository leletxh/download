name: Push File from URL

on:
  workflow_dispatch:
    inputs:
      url:
        description: 'URL of the file to download'
        required: true
        type: string

permissions:
  contents: write

jobs:
  push-file:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          lfs: true

      - name: Validate URL input
        run: |
          if [[ -z "${{ github.event.inputs.url }}" ]]; then
            echo "Error: URL input is empty"
            exit 1
          fi

      - name: Download file from URL
        run: |
          URL="${{ github.event.inputs.url }}"
          # 使用 basename 获取文件名；如果 URL 没有有效文件名，则使用 default_filename
          FILENAME=$(basename "$URL" | cut -d'?' -f1 | cut -d'#' -f1)
          if [[ -z "$FILENAME" || "$FILENAME" == "/" ]]; then
            FILENAME="downloaded_file"
          fi
          echo "Downloading $URL as $FILENAME"
          curl -L -o "$FILENAME" "$URL"

      - name: Configure Git
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'

      - name: Commit and push file
        run: |
          git lfs install
          FILENAME=$(basename "${{ github.event.inputs.url }}" | cut -d'?' -f1 | cut -d'#' -f1)
          if [[ -z "$FILENAME" || "$FILENAME" == "/" ]]; then
            FILENAME="downloaded_file"
          fi
          git add "$FILENAME"
          git commit -m "Add file from URL: ${{ github.event.inputs.url }}"
          git push
